<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Expected distributions of pairwise distances. • vimes</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">vimes</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Expected distributions of pairwise distances.</h1>
                        <h4 class="author">Thibaut Jombart, Anne Cori</h4>
            
            <h4 class="date">2017-03-06</h4>
          </div>

    
    
<div class="contents">
<p><em>vimes</em> uses reference distributions of (spatial, temporal, genetic) distances between pairs of cases on a transmission chain to define thresholds for the graph pruning algorithm. In such case, we asssume these distributions are known, typically from the literature. However, these distributions change when there are unobserved cases. In this vignette, we illustrate how the distribution of expected distances between cases is computed for a give reporting probability <code>pi</code>, and given a known distribution <em>F</em>(<em>d</em>).</p>
<div id="distributions-of-distances-with-missing-cases" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#distributions-of-distances-with-missing-cases" class="anchor"> </a></body></html>Distributions of distances with missing cases</h2>
<p>Let us assume a simple probability mass function of, say, the <em>serial interval</em>. We simulate it using the package <em>distcrete</em>, from a discretised Gamma distribution with shape 10 and rate 1.5:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
si &lt;-<span class="st"> </span>distcrete::<span class="kw">distcrete</span>(<span class="st">"gamma"</span>, 1L,
                           <span class="dt">shape =</span> <span class="dv">10</span>,
               <span class="dt">rate =</span> <span class="fl">1.2</span>)$<span class="kw">d</span>(<span class="dv">1</span>:<span class="dv">20</span>)

<span class="kw">plot</span>(si, <span class="dt">type =</span> <span class="st">"h"</span>, <span class="dt">lwd =</span> <span class="dv">10</span>, <span class="dt">lend=</span><span class="dv">2</span>,
     <span class="dt">xlab =</span> <span class="st">"Days after onset"</span>,
     <span class="dt">main =</span> <span class="st">"Serial interval distribution"</span>)</code></pre></div>
<p><img src="figs-dist/serial-1.png" width="576"></p>
<p>This distribution assumes a single generation of infection between cases. Its general form for a number <em>K</em> of generations between cases is given by <span class="math inline">\(K\)</span> convolutions of <em>F</em>(<em>d</em>). In <em>vimes</em>, these are internally computed by <code>convolve_empirical</code>. As the function is not exported, one needs to use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
si_10 &lt;-<span class="st"> </span>vimes:::<span class="kw">convolve_empirical</span>(si, <span class="dv">10</span>, <span class="ot">TRUE</span>)</code></pre></div>
<p>to obtain <em>K</em>=10 convolutions of the distribution (<code>si</code>); the last argument is to retain all intermediate convolutions for <em>k</em>=1, …, K.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">head</span>(si_10)
<span class="co">#&gt;                 1            2            3            4             5</span>
<span class="co">#&gt; [1,] 1.938717e-05 3.758623e-10 7.293147e-15 5.767392e-18 -1.156482e-18</span>
<span class="co">#&gt; [2,] 1.083100e-03 4.199648e-08 1.221299e-12 4.055198e-17  1.156482e-18</span>
<span class="co">#&gt; [3,] 1.002450e-02 1.561799e-06 7.953309e-11 2.942361e-15  5.782412e-19</span>
<span class="co">#&gt; [4,] 3.762795e-02 2.317407e-05 2.576001e-09 1.486062e-13  6.360653e-18</span>
<span class="co">#&gt; [5,] 8.260616e-02 1.852033e-04 4.595795e-08 4.524906e-12  2.781340e-16</span>
<span class="co">#&gt; [6,] 1.275300e-01 9.382892e-04 5.133773e-07 8.864759e-11  8.222011e-15</span>
<span class="co">#&gt;                 6             7            8             9            10</span>
<span class="co">#&gt; [1,] 1.856531e-17  6.029729e-19 0.000000e+00 -3.227393e-19 -6.432861e-18</span>
<span class="co">#&gt; [2,] 2.136538e-17 -1.428539e-18 0.000000e+00 -6.454785e-19 -6.215242e-18</span>
<span class="co">#&gt; [3,] 2.102409e-17 -3.160518e-19 2.902544e-18 -2.743284e-18 -6.369372e-18</span>
<span class="co">#&gt; [4,] 2.212527e-17 -1.000544e-18 0.000000e+00 -1.290957e-18 -6.713617e-18</span>
<span class="co">#&gt; [5,] 2.298509e-17  1.666924e-18 5.805088e-18 -2.097805e-18 -6.282872e-18</span>
<span class="co">#&gt; [6,] 1.701349e-17  1.848692e-18 2.902544e-18 -8.875329e-19 -6.615095e-18</span>
<span class="kw">apply</span>(si_10, <span class="dv">2</span>, sum)
<span class="co">#&gt;         1         2         3         4         5         6         7 </span>
<span class="co">#&gt; 0.9997120 0.9994241 0.9991362 0.9988485 0.9985608 0.9982732 0.9979857 </span>
<span class="co">#&gt;         8         9        10 </span>
<span class="co">#&gt; 0.9976983 0.9974110 0.9971237</span>

<span class="kw">matplot</span>(si_10[<span class="dv">1</span>:<span class="dv">120</span>,], <span class="dt">type =</span> <span class="st">"l"</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">rainbow</span>(<span class="dv">10</span>),
    <span class="dt">xlab =</span> <span class="st">"Days after onset"</span>,
    <span class="dt">main =</span> <span class="st">"Serial interval, k = 1, ..., 10 missing cases"</span>)
<span class="kw">mtext</span>(<span class="st">"from k = 1 (red) to k = 10 (purple)"</span>, <span class="dv">3</span>)</code></pre></div>
<p><img src="figs-dist/convolve2-1.png" width="576"></p>
</div>
<div id="integrating-over-missing-cases" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#integrating-over-missing-cases" class="anchor"> </a></body></html>Integrating over missing cases</h2>
<p>In practice, we do not know the number of generations between two cases, so we cannot use any of the convolutions above directly. However, it is possible to integrate over all possible values of <em>K</em>. In practice, we will limit the convolutions to a maximum value of <em>K</em> so that <em>p</em>(<em>k</em> &gt; <em>K</em>) &lt; threshold, defaulting to 0.001. The resulting distribution is a linear combination of the convolutions, weighted by the likelihoods of the corresponding values of <em>k</em>. These weights are computed for a given reporting probability <code>pi</code> by, for instance:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
w &lt;-<span class="st"> </span>vimes:::<span class="kw">get_weights</span>(<span class="fl">0.6</span>, <span class="dv">10</span>)
<span class="kw">plot</span>(w, <span class="dt">type =</span> <span class="st">"h"</span>, <span class="dt">xlab =</span> <span class="st">"k"</span>, <span class="dt">ylab =</span> <span class="st">"weight"</span>,
     <span class="dt">lwd =</span> <span class="dv">10</span>, <span class="dt">lend =</span> <span class="dv">2</span>, <span class="dt">main =</span> <span class="st">"Weights"</span>)</code></pre></div>
<p><img src="figs-dist/weights-1.png" width="576"></p>
<p>for a reporting probability of 0.6 and a maximum value of <em>k</em> of 10. The final distribution combines the previous convolutions using these weights. This is achieved by the (exported) function <code>dempiric</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
d_final &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dpaircase.html">dempiric</a></span>(si, <span class="fl">0.6</span>)
<span class="kw">head</span>(d_final)
<span class="co">#&gt; [1] 1.164337e-05 6.504836e-04 6.020754e-03 2.260365e-02 4.965499e-02</span>
<span class="co">#&gt; [6] 7.681575e-02</span>
<span class="kw">sum</span>(d_final)
<span class="co">#&gt; [1] 1</span>

pal &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">"navy"</span>, <span class="st">"lightblue"</span>, <span class="st">"grey"</span>))

<span class="kw">plot</span>(d_final[<span class="dv">1</span>:<span class="dv">80</span>], <span class="dt">type =</span> <span class="st">"h"</span>, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">lend =</span> <span class="dv">2</span>,
     <span class="dt">col =</span> <span class="kw">pal</span>(<span class="dv">80</span>), <span class="dt">xlab =</span> <span class="st">"Days after onset"</span>,
     <span class="dt">main =</span> <span class="st">"Distributions of temporal distances for pi = 60%"</span>)</code></pre></div>
<p><img src="figs-dist/final-1.png" width="576"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#distributions-of-distances-with-missing-cases">Distributions of distances with missing cases</a></li>
      <li><a href="#integrating-over-missing-cases">Integrating over missing cases</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Thibaut Jombart, Anne Cori.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
